<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelola Tugas - KelasOnline</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    <link rel="stylesheet" href="../assets/css/forms.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-graduation-cap"></i>
                <span>KelasOnline</span>
            </div>
            <div class="nav-menu">
                <a href="dashboard-dosen.html" class="nav-link">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="kelas-dosen.html" class="nav-link active">
                    <i class="fas fa-chalkboard"></i> Kelas Saya
                </a>
                <a href="#" class="nav-link">
                    <i class="fas fa-bell"></i>
                    <span class="badge">3</span>
                </a>
                <div class="nav-profile">
                    <img src="https://ui-avatars.com/api/?name=Dosen&background=2563EB&color=fff" alt="Profile">
                    <div class="profile-dropdown">
                        <a href="profil-dosen.html"><i class="fas fa-user"></i> Profil</a>
                        <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="dashboard-container">
        <!-- Breadcrumb -->
        <div class="breadcrumb">
            <a href="dashboard-dosen.html"><i class="fas fa-home"></i> Dashboard</a>
            <span>/</span>
            <a href="detail-kelas-dosen.html">Pemrograman Web</a>
            <span>/</span>
            <span class="active">Kelola Tugas</span>
        </div>

        <!-- Header -->
        <section class="page-header glass-effect">
            <div class="header-content">
                <h1><i class="fas fa-tasks"></i> Kelola Tugas</h1>
                <p>Pemrograman Web - Semester 5</p>
            </div>
            <button class="btn-primary" onclick="openModalTugas()">
                <i class="fas fa-plus"></i> Buat Tugas Baru
            </button>
        </section>

        <!-- Filter & Stats -->
        <section class="stats-row">
            <div class="stat-mini glass-effect">
                <i class="fas fa-tasks"></i>
                <div>
                    <h3>5</h3>
                    <p>Total Tugas</p>
                </div>
            </div>
            <div class="stat-mini glass-effect">
                <i class="fas fa-check-circle"></i>
                <div>
                    <h3>3</h3>
                    <p>Aktif</p>
                </div>
            </div>
            <div class="stat-mini glass-effect">
                <i class="fas fa-hourglass-half"></i>
                <div>
                    <h3>12</h3>
                    <p>Pending Review</p>
                </div>
            </div>
            <div class="stat-mini glass-effect">
                <i class="fas fa-star"></i>
                <div>
                    <h3>85%</h3>
                    <p>Rata-rata Nilai</p>
                </div>
            </div>
        </section>

        <!-- Tugas List -->
        <section class="tugas-list-container">
            <!-- Tugas Card 1 -->
            <div class="tugas-card-full glass-effect">
                <div class="tugas-card-header">
                    <div class="tugas-title-section">
                        <h3>Tugas 1: Membuat Landing Page</h3>
                        <span class="badge badge-success">Aktif</span>
                    </div>
                    <div class="tugas-menu">
                        <i class="fas fa-ellipsis-v"></i>
                        <div class="dropdown-menu">
                            <a href="#" onclick="viewSubmissions(1)"><i class="fas fa-file-alt"></i> Lihat Submission</a>
                            <a href="#" onclick="editTugas(1)"><i class="fas fa-edit"></i> Edit</a>
                            <a href="#" onclick="deleteTugas(1)" class="text-danger"><i class="fas fa-trash"></i> Hapus</a>
                        </div>
                    </div>
                </div>
                <p class="tugas-description">
                    Buat landing page sederhana untuk sebuah produk/jasa menggunakan HTML dan CSS. 
                    Design harus responsive dan menggunakan semantic HTML5.
                </p>
                <div class="tugas-details-grid">
                    <div class="detail-item">
                        <i class="fas fa-calendar-alt"></i>
                        <div>
                            <label>Deadline</label>
                            <strong>20 September 2024, 23:59</strong>
                        </div>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-file-archive"></i>
                        <div>
                            <label>Format</label>
                            <strong>ZIP, RAR (Max 5 MB)</strong>
                        </div>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-trophy"></i>
                        <div>
                            <label>Bobot</label>
                            <strong>15%</strong>
                        </div>
                    </div>
                </div>
                <div class="tugas-progress-section">
                    <div class="progress-stats">
                        <div class="stat-item">
                            <i class="fas fa-upload"></i>
                            <span><strong>28/32</strong> Terkirim</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-check-double"></i>
                            <span><strong>15/28</strong> Dinilai</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-star"></i>
                            <span>Rata-rata: <strong>87.5</strong></span>
                        </div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 87.5%;" data-tooltip="87.5% submission rate"></div>
                        </div>
                        <span class="progress-label">87.5%</span>
                    </div>
                </div>
                <div class="tugas-actions">
                    <button class="btn-primary" onclick="viewSubmissions(1)">
                        <i class="fas fa-file-alt"></i> Lihat Submission (15 Belum Dinilai)
                    </button>
                </div>
            </div>

            <!-- Tugas Card 2 -->
            <div class="tugas-card-full glass-effect">
                <div class="tugas-card-header">
                    <div class="tugas-title-section">
                        <h3>Tugas 2: Form Validation dengan JavaScript</h3>
                        <span class="badge badge-warning">Deadline Soon</span>
                    </div>
                    <div class="tugas-menu">
                        <i class="fas fa-ellipsis-v"></i>
                        <div class="dropdown-menu">
                            <a href="#" onclick="viewSubmissions(2)"><i class="fas fa-file-alt"></i> Lihat Submission</a>
                            <a href="#" onclick="editTugas(2)"><i class="fas fa-edit"></i> Edit</a>
                            <a href="#" onclick="deleteTugas(2)" class="text-danger"><i class="fas fa-trash"></i> Hapus</a>
                        </div>
                    </div>
                </div>
                <p class="tugas-description">
                    Implementasi validasi form menggunakan JavaScript. Form harus mencakup validasi email, password strength, dan konfirmasi password.
                </p>
                <div class="tugas-details-grid">
                    <div class="detail-item">
                        <i class="fas fa-calendar-alt"></i>
                        <div>
                            <label>Deadline</label>
                            <strong class="text-warning">25 September 2024, 23:59</strong>
                            <small class="countdown">‚è∞ 2 hari lagi</small>
                        </div>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-file-archive"></i>
                        <div>
                            <label>Format</label>
                            <strong>ZIP, RAR (Max 3 MB)</strong>
                        </div>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-trophy"></i>
                        <div>
                            <label>Bobot</label>
                            <strong>20%</strong>
                        </div>
                    </div>
                </div>
                <div class="tugas-progress-section">
                    <div class="progress-stats">
                        <div class="stat-item">
                            <i class="fas fa-upload"></i>
                            <span><strong>20/32</strong> Terkirim</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-check-double"></i>
                            <span><strong>8/20</strong> Dinilai</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-star"></i>
                            <span>Rata-rata: <strong>82.3</strong></span>
                        </div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 62.5%;"></div>
                        </div>
                        <span class="progress-label">62.5%</span>
                    </div>
                </div>
                <div class="tugas-actions">
                    <button class="btn-primary" onclick="viewSubmissions(2)">
                        <i class="fas fa-file-alt"></i> Lihat Submission (12 Belum Dinilai)
                    </button>
                </div>
            </div>

            <!-- Tugas Card 3 -->
            <div class="tugas-card-full glass-effect">
                <div class="tugas-card-header">
                    <div class="tugas-title-section">
                        <h3>Tugas 3: CRUD dengan PHP & MySQL</h3>
                        <span class="badge badge-danger">Expired</span>
                    </div>
                    <div class="tugas-menu">
                        <i class="fas fa-ellipsis-v"></i>
                        <div class="dropdown-menu">
                            <a href="#" onclick="viewSubmissions(3)"><i class="fas fa-file-alt"></i> Lihat Submission</a>
                            <a href="#" onclick="editTugas(3)"><i class="fas fa-edit"></i> Edit</a>
                            <a href="#" onclick="deleteTugas(3)" class="text-danger"><i class="fas fa-trash"></i> Hapus</a>
                        </div>
                    </div>
                </div>
                <p class="tugas-description">
                    Buat aplikasi CRUD sederhana menggunakan PHP dan MySQL. Implementasi Create, Read, Update, Delete dengan prepared statements.
                </p>
                <div class="tugas-details-grid">
                    <div class="detail-item">
                        <i class="fas fa-calendar-alt"></i>
                        <div>
                            <label>Deadline</label>
                            <strong class="text-danger">15 September 2024, 23:59</strong>
                            <small class="text-danger">Sudah berakhir</small>
                        </div>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-file-archive"></i>
                        <div>
                            <label>Format</label>
                            <strong>ZIP (Max 10 MB)</strong>
                        </div>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-trophy"></i>
                        <div>
                            <label>Bobot</label>
                            <strong>25%</strong>
                        </div>
                    </div>
                </div>
                <div class="tugas-progress-section">
                    <div class="progress-stats">
                        <div class="stat-item">
                            <i class="fas fa-upload"></i>
                            <span><strong>32/32</strong> Terkirim</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-check-double"></i>
                            <span><strong>32/32</strong> Dinilai</span>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-star"></i>
                            <span>Rata-rata: <strong>88.7</strong></span>
                        </div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div class="progress-fill success" style="width: 100%;"></div>
                        </div>
                        <span class="progress-label">100%</span>
                    </div>
                </div>
                <div class="tugas-actions">
                    <button class="btn-secondary" onclick="viewSubmissions(3)">
                        <i class="fas fa-check-circle"></i> Semua Sudah Dinilai
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal Create/Edit Tugas -->
    <div id="modalTugas" class="modal">
        <div class="modal-content glass-effect modal-xlarge">
            <div class="modal-header">
                <h2 id="modalTitle">
                    <i class="fas fa-plus-circle"></i>
                    Buat Tugas Baru
                </h2>
                <button class="modal-close" onclick="closeModalTugas()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="formTugas" onsubmit="submitTugas(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="judulTugas">
                            <i class="fas fa-heading"></i> Judul Tugas *
                        </label>
                        <input type="text" id="judulTugas" class="form-control" 
                               placeholder="Contoh: Membuat Landing Page" required>
                    </div>

                    <div class="form-group">
                        <label for="deskripsiTugas">
                            <i class="fas fa-align-left"></i> Deskripsi Tugas *
                        </label>
                        <textarea id="deskripsiTugas" class="form-control" rows="5" 
                                  placeholder="Jelaskan detail tugas yang harus dikerjakan mahasiswa..." required></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="deadlineDate">
                                <i class="fas fa-calendar"></i> Tanggal Deadline *
                            </label>
                            <input type="date" id="deadlineDate" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="deadlineTime">
                                <i class="fas fa-clock"></i> Jam Deadline *
                            </label>
                            <input type="time" id="deadlineTime" class="form-control" value="23:59" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="maxFileSize">
                                <i class="fas fa-weight"></i> Ukuran File Maksimal (MB) *
                            </label>
                            <input type="number" id="maxFileSize" class="form-control" 
                                   placeholder="5" min="1" max="50" required>
                        </div>
                        <div class="form-group">
                            <label for="bobotNilai">
                                <i class="fas fa-trophy"></i> Bobot Nilai (%) *
                            </label>
                            <input type="number" id="bobotNilai" class="form-control" 
                                   placeholder="15" min="1" max="100" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>
                            <i class="fas fa-file-archive"></i> Format File yang Diizinkan *
                        </label>
                        <div class="checkbox-group">
                            <label class="checkbox-item">
                                <input type="checkbox" name="format" value="zip" checked>
                                <span>ZIP</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="format" value="rar">
                                <span>RAR</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="format" value="pdf">
                                <span>PDF</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" name="format" value="docx">
                                <span>DOCX</span>
                            </label>
                        </div>
                    </div>

                    <div class="info-box">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>Catatan:</strong>
                            <ul>
                                <li>Mahasiswa hanya bisa submit sebelum deadline</li>
                                <li>Submission setelah deadline akan ditandai sebagai "Late"</li>
                                <li>Format file yang tidak sesuai akan otomatis ditolak</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" onclick="closeModalTugas()">
                        <i class="fas fa-times"></i> Batal
                    </button>
                    <button type="submit" class="btn-primary">
                        <i class="fas fa-save"></i> Simpan Tugas
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script src="../assets/js/validation.js"></script>
    <script src="../assets/js/ui-interactions.js"></script>
    <script>
        let currentTugasId = null;
        let isEditMode = false;

        // Open Modal
        function openModalTugas() {
            isEditMode = false;
            document.getElementById('modalTitle').innerHTML = '<i class="fas fa-plus-circle"></i> Buat Tugas Baru';
            document.getElementById('formTugas').reset();
            
            // Set default deadline (7 days from now)
            const today = new Date();
            today.setDate(today.getDate() + 7);
            document.getElementById('deadlineDate').valueAsDate = today;
            
            document.getElementById('modalTugas').classList.add('active');
        }

        // Close Modal
        function closeModalTugas() {
            document.getElementById('modalTugas').classList.remove('active');
            document.getElementById('formTugas').reset();
        }

        // Submit Form
        function submitTugas(event) {
            event.preventDefault();
            
            const formats = Array.from(document.querySelectorAll('input[name="format"]:checked'))
                .map(cb => cb.value);
            
            if (formats.length === 0) {
                showToast('Pilih minimal 1 format file!', 'error');
                return;
            }
            
            const formData = {
                judul: document.getElementById('judulTugas').value,
                deskripsi: document.getElementById('deskripsiTugas').value,
                deadline_date: document.getElementById('deadlineDate').value,
                deadline_time: document.getElementById('deadlineTime').value,
                max_file_size: document.getElementById('maxFileSize').value,
                bobot: document.getElementById('bobotNilai').value,
                allowed_formats: formats
            };
            
            // TODO: Send to backend
            console.log('Tugas data:', formData);
            
            showToast(isEditMode ? 'Tugas berhasil diupdate!' : 'Tugas berhasil dibuat!', 'success');
            closeModalTugas();
            
            setTimeout(() => location.reload(), 1500);
        }

        // Edit Tugas
        function editTugas(id) {
            isEditMode = true;
            currentTugasId = id;
            document.getElementById('modalTitle').innerHTML = '<i class="fas fa-edit"></i> Edit Tugas';
            
            // TODO: Load data from backend
            document.getElementById('judulTugas').value = 'Membuat Landing Page';
            document.getElementById('deskripsiTugas').value = 'Buat landing page sederhana...';
            document.getElementById('deadlineDate').value = '2024-09-20';
            document.getElementById('deadlineTime').value = '23:59';
            document.getElementById('maxFileSize').value = '5';
            document.getElementById('bobotNilai').value = '15';
            
            document.getElementById('modalTugas').classList.add('active');
        }

        // Delete Tugas
        function deleteTugas(id) {
            if (confirm('Apakah Anda yakin ingin menghapus tugas ini?\nSemua submission mahasiswa akan terhapus!')) {
                // TODO: Call backend
                showToast('Tugas berhasil dihapus', 'success');
                setTimeout(() => location.reload(), 1500);
            }
        }

        // View Submissions
        function viewSubmissions(id) {
            window.location.href = `lihat-submission.html?tugas=${id}`;
        }

        // Show Toast
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast toast-${type} active`;
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('modalTugas');
            if (event.target === modal) {
                closeModalTugas();
            }
        }

        // Set minimum deadline date (tomorrow)
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);
        document.getElementById('deadlineDate').min = tomorrow.toISOString().split('T')[0];
    </script>
</body>
</html>

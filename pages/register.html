<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar - Sistem Kelas Online Mini</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/forms.css">
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <!-- Header -->
            <div class="auth-header">
                <div class="auth-logo">ğŸ“š</div>
                <h1 class="auth-title">Daftar Akun Baru</h1>
                <p class="auth-subtitle">Bergabunglah dengan platform e-learning kami</p>
            </div>

            <!-- Alert -->
            <div id="alertContainer" style="padding: 0 2rem; padding-top: 2rem;"></div>

            <!-- Body -->
            <div class="auth-body">
                <form id="registerForm" novalidate>
                    <!-- Nama Lengkap -->
                    <div class="form-group form-group-icon">
                        <label for="nama" class="form-label">Nama Lengkap</label>
                        <span class="form-icon">ğŸ‘¤</span>
                        <input 
                            type="text" 
                            id="nama" 
                            name="nama" 
                            class="form-input" 
                            placeholder="Masukkan nama lengkap"
                            required
                        >
                        <div class="form-error" id="namaError">Nama lengkap harus diisi</div>
                    </div>

                    <!-- Email -->
                    <div class="form-group form-group-icon">
                        <label for="email" class="form-label">Email</label>
                        <span class="form-icon">ğŸ“§</span>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            class="form-input" 
                            placeholder="nama@email.com"
                            required
                        >
                        <div class="form-error" id="emailError">Email tidak valid</div>
                    </div>

                    <!-- Role Selection -->
                    <div class="form-group">
                        <label class="form-label">Daftar Sebagai</label>
                        <div class="radio-group">
                            <label class="radio-option" id="radioMahasiswa">
                                <input type="radio" name="role" value="mahasiswa" checked>
                                <div>
                                    <strong>ğŸ“ Mahasiswa</strong>
                                    <p style="font-size: 0.875rem; color: var(--gray); margin: 0.25rem 0 0 0;">
                                        Untuk mengikuti kelas dan mengakses materi
                                    </p>
                                </div>
                            </label>
                            <label class="radio-option" id="radioDosen">
                                <input type="radio" name="role" value="dosen">
                                <div>
                                    <strong>ğŸ‘¨â€ğŸ« Dosen</strong>
                                    <p style="font-size: 0.875rem; color: var(--gray); margin: 0.25rem 0 0 0;">
                                        Untuk membuat dan mengelola kelas
                                    </p>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Password -->
                    <div class="form-group form-group-icon">
                        <label for="password" class="form-label">Password</label>
                        <span class="form-icon">ğŸ”’</span>
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            class="form-input" 
                            placeholder="Minimal 8 karakter"
                            required
                        >
                        <button type="button" class="form-toggle-password" id="togglePassword">
                            ğŸ‘ï¸
                        </button>
                        <div class="form-error" id="passwordError">Password minimal 8 karakter</div>
                        
                        <!-- Password Strength -->
                        <div class="password-strength" id="passwordStrength">
                            <div class="strength-bar">
                                <div class="strength-progress" id="strengthProgress"></div>
                            </div>
                            <div class="strength-text" id="strengthText"></div>
                        </div>
                    </div>

                    <!-- Confirm Password -->
                    <div class="form-group form-group-icon">
                        <label for="confirmPassword" class="form-label">Konfirmasi Password</label>
                        <span class="form-icon">ğŸ”’</span>
                        <input 
                            type="password" 
                            id="confirmPassword" 
                            name="confirmPassword" 
                            class="form-input" 
                            placeholder="Ulangi password"
                            required
                        >
                        <button type="button" class="form-toggle-password" id="toggleConfirmPassword">
                            ğŸ‘ï¸
                        </button>
                        <div class="form-error" id="confirmPasswordError">Password tidak cocok</div>
                    </div>

                    <!-- Terms & Conditions -->
                    <div class="form-check">
                        <input type="checkbox" id="terms" name="terms" class="form-check-input" required>
                        <label for="terms" class="form-check-label">
                            Saya menyetujui <a href="#" class="form-link">Syarat & Ketentuan</a>
                        </label>
                    </div>
                    <div class="form-error" id="termsError">Anda harus menyetujui syarat & ketentuan</div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary btn-block" id="registerBtn">
                        Daftar Sekarang
                    </button>
                </form>
            </div>

            <!-- Footer -->
            <div class="auth-footer">
                <p style="margin-bottom: 1rem; color: var(--gray);">
                    Sudah punya akun? 
                    <a href="login.html" class="form-link">Masuk di sini</a>
                </p>
                <a href="../pages/index.html" class="form-link">
                    â† Kembali ke Beranda
                </a>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Mendaftarkan akun...</p>
    </div>

    <script src="../assets/js/validation.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const registerForm = document.getElementById('registerForm');
            const namaInput = document.getElementById('nama');
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            const termsCheckbox = document.getElementById('terms');
            const togglePassword = document.getElementById('togglePassword');
            const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
            const registerBtn = document.getElementById('registerBtn');
            const loadingOverlay = document.getElementById('loadingOverlay');
            const alertContainer = document.getElementById('alertContainer');
            const radioMahasiswa = document.getElementById('radioMahasiswa');
            const radioDosen = document.getElementById('radioDosen');

            // Radio button styling
            document.querySelectorAll('input[name="role"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    radioMahasiswa.classList.remove('checked');
                    radioDosen.classList.remove('checked');
                    if (this.value === 'mahasiswa') {
                        radioMahasiswa.classList.add('checked');
                    } else {
                        radioDosen.classList.add('checked');
                    }
                });
            });
            radioMahasiswa.classList.add('checked');

            // Toggle Password Visibility
            togglePassword.addEventListener('click', function() {
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                this.textContent = type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
            });

            toggleConfirmPassword.addEventListener('click', function() {
                const type = confirmPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                confirmPasswordInput.setAttribute('type', type);
                this.textContent = type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
            });

            // Password Strength Indicator
            passwordInput.addEventListener('input', function() {
                const password = this.value;
                const strengthIndicator = document.getElementById('passwordStrength');
                const strengthProgress = document.getElementById('strengthProgress');
                const strengthText = document.getElementById('strengthText');

                if (password.length === 0) {
                    strengthIndicator.classList.remove('show');
                    return;
                }

                strengthIndicator.classList.add('show');

                const strength = checkPasswordStrength(password);
                
                strengthProgress.className = 'strength-progress ' + strength.level;
                strengthText.className = 'strength-text ' + strength.level;
                strengthText.textContent = strength.text;
            });

            // Real-time validation
            namaInput.addEventListener('blur', function() {
                validateRequired(this.value, 'namaError', 'Nama lengkap harus diisi');
            });

            emailInput.addEventListener('blur', function() {
                validateEmail(this.value, 'emailError');
            });

            passwordInput.addEventListener('blur', function() {
                validatePassword(this.value, 'passwordError');
            });

            confirmPasswordInput.addEventListener('blur', function() {
                validatePasswordMatch(passwordInput.value, this.value, 'confirmPasswordError');
            });

            // Form Submit
            registerForm.addEventListener('submit', function(e) {
                e.preventDefault();

                // Clear previous alerts
                alertContainer.innerHTML = '';

                const nama = namaInput.value.trim();
                const email = emailInput.value.trim();
                const password = passwordInput.value;
                const confirmPassword = confirmPasswordInput.value;
                const role = document.querySelector('input[name="role"]:checked').value;
                const terms = termsCheckbox.checked;

                // Validate all fields
                const isNamaValid = validateRequired(nama, 'namaError', 'Nama lengkap harus diisi');
                const isEmailValid = validateEmail(email, 'emailError');
                const isPasswordValid = validatePassword(password, 'passwordError');
                const isConfirmPasswordValid = validatePasswordMatch(password, confirmPassword, 'confirmPasswordError');
                
                // Validate terms
                const termsError = document.getElementById('termsError');
                if (!terms) {
                    termsError.classList.add('show');
                } else {
                    termsError.classList.remove('show');
                }

                if (!isNamaValid || !isEmailValid || !isPasswordValid || !isConfirmPasswordValid || !terms) {
                    showAlert('error', 'Mohon lengkapi semua field dengan benar');
                    return;
                }

                // Show loading
                loadingOverlay.classList.add('show');
                registerBtn.disabled = true;

                // Simulate API call (replace with actual backend call)
                setTimeout(() => {
                    // Hide loading
                    loadingOverlay.classList.remove('show');
                    registerBtn.disabled = false;

                    // Success
                    showAlert('success', 'Pendaftaran berhasil! Mengalihkan ke halaman login...');
                    
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 2000);

                    // INTEGRATION NOTE for Juan:
                    // Replace above with actual backend call like:
                    /*
                    fetch('../backend/auth/register.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ nama, email, password, role })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showAlert('success', 'Pendaftaran berhasil! Mengalihkan ke login...');
                            setTimeout(() => {
                                window.location.href = 'login.html';
                            }, 2000);
                        } else {
                            showAlert('error', data.message || 'Pendaftaran gagal!');
                        }
                    })
                    .catch(error => {
                        showAlert('error', 'Terjadi kesalahan. Silakan coba lagi.');
                        console.error('Error:', error);
                    });
                    */
                }, 1500);
            });

            // Show Alert Function
            function showAlert(type, message) {
                const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
                alertContainer.innerHTML = `
                    <div class="alert ${alertClass}">
                        ${type === 'success' ? 'âœ“' : 'âœ•'} ${message}
                    </div>
                `;
            }

            // Check Password Strength
            function checkPasswordStrength(password) {
                let strength = 0;
                
                if (password.length >= 8) strength++;
                if (password.match(/[a-z]+/)) strength++;
                if (password.match(/[A-Z]+/)) strength++;
                if (password.match(/[0-9]+/)) strength++;
                if (password.match(/[$@#&!]+/)) strength++;

                if (strength <= 2) {
                    return { level: 'weak', text: 'Password Lemah' };
                } else if (strength <= 4) {
                    return { level: 'medium', text: 'Password Sedang' };
                } else {
                    return { level: 'strong', text: 'Password Kuat' };
                }
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Tugas - Sistem Kelas Online</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/dashboard.css">
    <link rel="stylesheet" href="../assets/css/forms.css">
</head>
<body>
    <div class="dashboard-wrapper">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="../pages/index.html" class="sidebar-brand">
                    <span class="sidebar-logo">üìö</span>
                    <span>KelasOnline</span>
                </a>
            </div>
            <nav class="sidebar-menu">
                <div class="sidebar-menu-section">
                    <div class="sidebar-menu-title">Menu Utama</div>
                    <ul class="sidebar-menu-list">
                        <li class="sidebar-menu-item">
                            <a href="dashboard-mahasiswa.html" class="sidebar-menu-link">
                                <span class="sidebar-menu-icon">üè†</span>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li class="sidebar-menu-item">
                            <a href="kelas-mahasiswa.html" class="sidebar-menu-link active">
                                <span class="sidebar-menu-icon">üìö</span>
                                <span>Kelas Saya</span>
                            </a>
                        </li>
                        <li class="sidebar-menu-item">
                            <a href="#" class="sidebar-menu-link">
                                <span class="sidebar-menu-icon">üìù</span>
                                <span>Tugas</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            <div class="sidebar-footer">
                <div class="sidebar-user">
                    <div class="sidebar-user-avatar">JD</div>
                    <div class="sidebar-user-info">
                        <div class="sidebar-user-name">John Doe</div>
                        <div class="sidebar-user-role">Mahasiswa</div>
                    </div>
                </div>
                <button class="btn btn-danger btn-block btn-sm" onclick="logout()" style="margin-top: 1rem;">Logout</button>
            </div>
        </aside>

        <main class="dashboard-main">
            <div class="dashboard-topbar">
                <div class="topbar-left">
                    <button class="topbar-toggle" id="sidebarToggle">
                        <span></span><span></span><span></span>
                    </button>
                    <h1 class="topbar-title">Upload Tugas</h1>
                </div>
                <div class="topbar-right">
                    <div class="topbar-notification">üîî<span class="notification-badge">3</span></div>
                    <div class="topbar-profile">
                        <div class="topbar-avatar">JD</div>
                        <span>John Doe</span>
                    </div>
                </div>
            </div>

            <div class="dashboard-content">
                <!-- Assignment Info -->
                <div class="content-section">
                    <div class="alert alert-info">
                        <div>
                            <h4 style="margin-bottom: 0.5rem;">üìù Tugas 1: Membuat Landing Page</h4>
                            <p style="margin: 0; opacity: 0.9;">Kelas: Pemrograman Web ‚Ä¢ Deadline: 15 Desember 2025, 23:59</p>
                        </div>
                    </div>

                    <div style="background: var(--white); padding: 1.5rem; border-radius: 0.75rem; margin-top: 1rem;">
                        <h4 style="margin-bottom: 1rem;">üìã Deskripsi Tugas</h4>
                        <p class="text-gray">
                            Buatlah sebuah landing page untuk website portofolio pribadi menggunakan HTML dan CSS. Landing page harus mencakup:
                        </p>
                        <ul style="color: var(--gray); margin-left: 1.5rem;">
                            <li>Section Hero dengan nama dan profesi</li>
                            <li>Section About Me</li>
                            <li>Section Skills atau Services</li>
                            <li>Section Portfolio (minimal 3 project)</li>
                            <li>Section Contact dengan form</li>
                            <li>Responsive design untuk mobile dan desktop</li>
                        </ul>

                        <div class="alert alert-warning" style="margin-top: 1rem;">
                            ‚ö†Ô∏è <strong>Catatan:</strong> File yang diupload harus dalam format ZIP berisi semua file HTML, CSS, dan assets. Ukuran maksimal 5MB.
                        </div>
                    </div>
                </div>

                <!-- Upload Form -->
                <div class="content-section">
                    <h3 class="mb-3">üì§ Upload Pengerjaan Tugas</h3>

                    <div id="alertContainer"></div>

                    <form id="uploadForm" style="max-width: 700px;">
                        <!-- Catatan -->
                        <div class="form-group">
                            <label for="catatan" class="form-label">Catatan (Opsional)</label>
                            <textarea 
                                id="catatan" 
                                class="form-textarea" 
                                placeholder="Tambahkan catatan untuk dosen..."
                                rows="4"
                            ></textarea>
                            <div class="form-help">Jelaskan pendekatan atau hal khusus dari pengerjaan Anda</div>
                        </div>

                        <!-- File Upload -->
                        <div class="form-group">
                            <label class="form-label">File Tugas *</label>
                            <div class="file-upload">
                                <input 
                                    type="file" 
                                    id="fileInput" 
                                    class="file-upload-input"
                                    accept=".zip,.rar,.pdf,.doc,.docx"
                                    required
                                >
                                <label for="fileInput" class="file-upload-label" id="fileLabel">
                                    <div class="file-upload-icon">üìÅ</div>
                                    <div class="file-upload-text">Klik atau Drag & Drop File</div>
                                    <div class="file-upload-hint">Format: ZIP, RAR, PDF, DOC, DOCX (Max: 5MB)</div>
                                </label>
                                <div class="file-upload-preview" id="filePreview"></div>
                            </div>
                            <div class="form-error" id="fileInputError">File harus dipilih</div>
                        </div>

                        <!-- Progress Bar (hidden initially) -->
                        <div id="uploadProgress" style="display: none; margin-bottom: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="font-weight: 600;">Uploading...</span>
                                <span id="progressPercent">0%</span>
                            </div>
                            <div style="height: 8px; background: var(--gray-lighter); border-radius: 999px; overflow: hidden;">
                                <div id="progressBar" style="height: 100%; background: var(--primary-color); width: 0%; transition: width 0.3s;"></div>
                            </div>
                        </div>

                        <!-- Confirmation -->
                        <div class="form-check" style="margin-bottom: 1.5rem;">
                            <input type="checkbox" id="confirm" class="form-check-input" required>
                            <label for="confirm" class="form-check-label">
                                Saya menyatakan bahwa tugas ini adalah hasil karya sendiri
                            </label>
                        </div>

                        <!-- Buttons -->
                        <div style="display: flex; gap: 1rem;">
                            <button type="submit" class="btn btn-primary" id="submitBtn">
                                üì§ Upload Tugas
                            </button>
                            <a href="detail-kelas-mahasiswa.html" class="btn btn-outline">
                                Batal
                            </a>
                        </div>
                    </form>
                </div>

                <!-- Submission History (if any) -->
                <div class="content-section">
                    <h3 class="mb-3">üìú Riwayat Pengumpulan</h3>
                    
                    <div class="empty-state" style="padding: 2rem;">
                        <div class="empty-state-icon" style="font-size: 3rem; margin-bottom: 1rem;">üì≠</div>
                        <h4 class="empty-state-title" style="font-size: 1.25rem;">Belum Ada Pengumpulan</h4>
                        <p class="empty-state-text">Anda belum pernah mengumpulkan tugas ini</p>
                    </div>

                    <!-- Example of submission history (uncomment to show)
                    <div class="card">
                        <div class="card-body">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <h5>Pengumpulan #1</h5>
                                    <p class="text-gray">Dikumpulkan: 14 Des 2025, 20:30</p>
                                    <p class="text-gray">File: landing-page-portfolio.zip (2.3 MB)</p>
                                    <p class="text-gray">Status: <span class="badge badge-success">Dinilai</span> Nilai: <strong>85</strong></p>
                                </div>
                                <button class="btn btn-outline btn-sm">Lihat Detail</button>
                            </div>
                        </div>
                    </div>
                    -->
                </div>
            </div>
        </main>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Mengupload tugas...</p>
    </div>

    <script src="../assets/js/validation.js"></script>
    <script src="../assets/js/file-upload-handler.js"></script>
    <script src="../assets/js/ui-interactions.js"></script>
    <script>
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        const uploadForm = document.getElementById('uploadForm');
        const fileInput = document.getElementById('fileInput');
        const fileLabel = document.getElementById('fileLabel');
        const filePreview = document.getElementById('filePreview');
        const submitBtn = document.getElementById('submitBtn');
        const alertContainer = document.getElementById('alertContainer');
        const uploadProgress = document.getElementById('uploadProgress');
        const progressBar = document.getElementById('progressBar');
        const progressPercent = document.getElementById('progressPercent');

        sidebarToggle.addEventListener('click', function() {
            sidebar.classList.toggle('active');
        });

        // File upload handling
        fileInput.addEventListener('change', function() {
            const file = this.files[0];
            
            if (!file) {
                filePreview.classList.remove('show');
                return;
            }

            // Validate
            const validationOptions = {
                allowedTypes: ['zip', 'rar', 'pdf', 'doc', 'docx'],
                maxSize: 5 * 1024 * 1024 // 5MB
            };

            if (!validateFile(file, 'fileInputError', validationOptions)) {
                this.value = '';
                return;
            }

            // Show preview
            const fileName = file.name;
            const fileSize = formatFileSize(file.size);
            const fileExt = fileName.split('.').pop().toLowerCase();
            
            let icon = 'üìÑ';
            if (fileExt === 'zip' || fileExt === 'rar') icon = 'üì¶';
            else if (fileExt === 'pdf') icon = 'üìï';

            filePreview.innerHTML = `
                <div class="file-preview-item">
                    <div class="file-preview-icon">${icon}</div>
                    <div class="file-preview-info">
                        <div class="file-preview-name">${fileName}</div>
                        <div class="file-preview-size">${fileSize}</div>
                    </div>
                    <button type="button" class="file-preview-remove" onclick="removeFile('fileInput')">‚úï</button>
                </div>
            `;
            filePreview.classList.add('show');
        });

        // Drag and drop
        fileLabel.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });

        fileLabel.addEventListener('dragleave', function() {
            this.classList.remove('dragover');
        });

        fileLabel.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                fileInput.dispatchEvent(new Event('change'));
            }
        });

        // Form submit
        uploadForm.addEventListener('submit', function(e) {
            e.preventDefault();

            alertContainer.innerHTML = '';

            const file = fileInput.files[0];
            const catatan = document.getElementById('catatan').value.trim();
            const confirm = document.getElementById('confirm').checked;

            if (!file) {
                showAlert('error', 'File tugas harus dipilih');
                return;
            }

            if (!confirm) {
                showAlert('error', 'Anda harus mengkonfirmasi keaslian tugas');
                return;
            }

            // Show progress
            uploadProgress.style.display = 'block';
            submitBtn.disabled = true;

            // Simulate upload progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    // Success
                    setTimeout(() => {
                        uploadProgress.style.display = 'none';
                        submitBtn.disabled = false;
                        showAlert('success', 'Tugas berhasil diupload! Menunggu penilaian dosen.');
                        
                        // Reset form
                        setTimeout(() => {
                            window.location.href = 'detail-kelas-mahasiswa.html';
                        }, 2000);
                    }, 500);
                }
                progressBar.style.width = progress + '%';
                progressPercent.textContent = Math.round(progress) + '%';
            }, 200);

            // INTEGRATION NOTE for Juan:
            // Replace with actual file upload
            /*
            const formData = new FormData();
            formData.append('file', file);
            formData.append('catatan', catatan);
            formData.append('tugas_id', getTugasId());

            fetch('../backend/submission/submit.php', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('success', 'Tugas berhasil diupload!');
                    setTimeout(() => window.location.href = 'detail-kelas-mahasiswa.html', 1500);
                } else {
                    showAlert('error', data.message);
                }
            })
            .catch(error => {
                showAlert('error', 'Terjadi kesalahan saat upload');
            });
            */
        });

        function showAlert(type, message) {
            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            alertContainer.innerHTML = `
                <div class="alert ${alertClass}">
                    ${type === 'success' ? '‚úì' : '‚úï'} ${message}
                </div>
            `;
        }

        window.removeFile = function(inputId) {
            const input = document.getElementById(inputId);
            input.value = '';
            filePreview.classList.remove('show');
            filePreview.innerHTML = '';
        };

        function logout() {
            if (confirm('Apakah Anda yakin ingin logout?')) {
                window.location.href = '../pages/login.html';
            }
        }
    </script>
</body>
</html>
